# Patient Record - Type "22" & "27"
# Notes:
# - Type 22 records are sent alone as part of the regular Update/Load Process
# - Type 27 records act like a delete and add (used when patient's complete history is re-sent)
# - Default values unless already listed are NULL for nullable fields and a single space for non-nullable fields
record_type: "27"
description: "Patient record with identification, general, pharmacy, and dental information"

fields:
  # Field 01 - Record Type
  - name: "Record Type"
    key: "record_type"
    length: 2
    padding: "left"
    pad_char: "0"
    required: true
    allowed_values: ["22", "27"]
    default_value: "27"
    # Position: 001-002
    # "27" (Alternative Patient Record), denote a Patient Record

  # Field 02 - Carrier ID
  - name: "Carrier ID"
    key: "carrier_id"
    length: 2
    padding: "left"
    pad_char: "0"
    required: true
    # Position: 003-004
    # ESC-assigned Carrier ID # for the insurance carrier

  # Field 03 - Group Number
  - name: "Group Number"
    key: "group_number"
    length: 10
    padding: "right"
    pad_char: " "
    required: true
    # Position: 005-014
    # Group Number assigned by the Customer (as appears on member's card)

  # Field 04 - SAS
  - name: "SAS"
    key: "sas"
    length: 9
    padding: "right"
    pad_char: " "
    required: true
    # Position: 015-023
    # Subgroup (3) / Account (3) / Suffix (3)

  # Field 05 - Client ID
  - name: "Client ID"
    key: "client_id"
    length: 15
    padding: "right"
    pad_char: " "
    required: true
    # Position: 024-038
    # Client's ID number

  # Field 06 - Current Patient Code
  - name: "Current Patient Code"
    key: "current_patient_code"
    length: 3
    padding: "right"
    pad_char: " "
    required: true
    # Position: 039-041
    # Unique code (within carrier/group/client) assigned by customer or adjudication system
    # Adjudication system uses 'V' + 2 digit code (e.g. V01) for patients added on-the-fly

  # ========== GENERAL SECTION ==========

  # Field 07 - General Processing Mode
  - name: "General Processing Mode"
    key: "general_processing_mode"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["B", "R", "U"]
    transform: "general_processing_mode?.ToUpper()"
    # Position: 042-042
    # B = Bypass record entirely
    # R = Full replacement (blank values update to blank, mandatory fields must be valued)
    # U = Update only valued fields (mandatory fields cannot be blanked out)

  # Field 08 - Relationship Code
  - name: "Relationship Code"
    key: "relationship_code"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["0", "1", "2", "3", "4"]
    transform_lookup: "Lookup(\"relationship_codes\", relationship_code, relationship_code)"
    # Position: 043-043
    # 0 = Cardholder
    # 1 = Spouse
    # 2 = Child (underage)
    # 3 = Child (overage)
    # 4 = Disabled dependant
    # If value does not exist in database AND Pharmacy is Bypassed, defaults to 0

  # Field 09 - Full Patient Last Name
  - name: "Full Patient Last Name"
    key: "patient_last_name"
    length: 30
    padding: "right"
    pad_char: " "
    required: false
    transform: "patient_last_name?.ToUpper()"
    # Position: 044-073
    # Mandatory when creating a new patient
    # If mode is U and * is sent in first position, error will be generated

  # Field 10 - Full Patient First Name/Initial
  - name: "Full Patient First Name/Initial"
    key: "patient_first_name"
    length: 30
    padding: "right"
    pad_char: " "
    required: false
    transform: "patient_first_name?.ToUpper()"
    # Position: 074-103
    # Mandatory when creating a new patient
    # If mode is U and * is sent in first position, error will be generated

  # Field 11 - Patient Middle Initial
  - name: "Patient Middle Initial"
    key: "patient_middle_initial"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    transform: "patient_middle_initial?.ToUpper()"
    # Position: 104-104
    # If not valued, defaults to Blank

  # Field 12 - Patient Date of Birth
  - name: "Patient Date of Birth"
    key: "patient_date_of_birth"
    length: 8
    padding: "right"
    pad_char: " "
    required: true
    # Position: 105-112
    # Date of birth of the patient (YYYYMMDD)
    # If value does not exist in database AND Pharmacy is Bypassed, defaults to 00000000

  # Field 13 - Patient Sex
  - name: "Patient Sex"
    key: "patient_sex"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["M", "F", "U"]
    transform: "patient_sex?.ToUpper()"
    # Position: 113-113
    # M = Male, F = Female, U = Unknown

  # Field 14 - New Patient Code
  - name: "New Patient Code"
    key: "new_patient_code"
    length: 3
    padding: "right"
    pad_char: " "
    required: false
    # Position: 114-116
    # Unique code assigned by customer to a patient
    # If valued, patient code will be changed to new patient code
    # Used for DUR and Rx Report processing
    # Unique within the family
    # If mode is U and * is sent in first position, error will be generated
    # If not valued, will not be processed regardless of mode

  # Field 15 - Dental enrolment date
  - name: "Dental enrolment date"
    key: "dental_enrolment_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: false
    default_value: "00000000"
    # Position: 117-124
    # Date patient enrolled for dental coverage - used in late entrant and rising max processing
    # If not valued, defaults to 00000000
    # Valid values: 00000000, 99999999, or valid date

  # Field 16 - Filler
  - name: "Filler"
    key: "filler_general"
    length: 58
    padding: "right"
    pad_char: " "
    default_value: " "
    required: true
    # Position: 125-182

  # ========== PHARMACY SECTION ==========

  # Field 17
  # Format: X(1)
  # Required: Y
  # Position: 183-183
  # Description: • B – Bypass record entirely.
  #              • R – Full replacement of information – Note: If a blank is submitted for a field on a full replacement,
  #                the field will be updated to blank. If the field is mandatory, it must be valued in R mode unless
  #                otherwise specified.
  #              • U – Update only fields which are valued (non blank)
  #              • If U selected, mandatory fields do not need to be sent unless they are being changed.
  #              • Mandatory fields cannot be blanked out.
  #              • If data currently exists on a non-mandatory field and it is to be updated to "blank", zeros or the
  #                default value (depending on format of field), then send "*" in the first position of the field to be
  #                blanked out.
  - name: "Pharmacy Processing Mode"
    key: "pharmacy_processing_mode"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["B", "R", "U"]
    transform: "pharmacy_processing_mode?.ToUpper()"

  # Field 18
  # Format: 9(8)
  # Required: Y
  # Position: 184-191
  # Description: The effective date of the patient's drug coverage.
  #              For this field, if the value does not already exist in the database AND Pharmacy is Bypassed, then the
  #              date will default to 00000000.
  - name: "Drug Effective Date"
    key: "drug_effective_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: true

  # Field 19
  # Format: 9(8)
  # Required: N
  # Position: 192-199
  # Description: The termination date of the patient's drug coverage.
  #              For this field, if the value does not already exist in the database AND Pharmacy is Bypassed, then the
  #              effective date will be 00000000. Otherwise, system will default to 99999999 if no date valued.
  #              Note that all Dental Expiry Dates are the first day of non-coverage. Pharmacy Expiry Dates are the last
  #              day of coverage.
  - name: "Drug Termination Date"
    key: "drug_termination_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: false
    default_value: "99999999"

  # Field 20
  # Format: X(5)
  # Required: N
  # Position: 200-204
  # Description: The drug plan number for this patient. Leave blank to default to the client/group plan number.
  - name: "Plan Number"
    key: "pharmacy_plan_number"
    length: 5
    padding: "right"
    pad_char: " "
    required: false

  # Field 21
  # Format: 9(5)
  # Required: N
  # Position: 205-209
  # Description: 0 is a valid value for this field.
  #              Blank defaults to 0.
  #              If 0, maintain current benefit override code on updates.
  - name: "Patient Benefit Override Code"
    key: "pharmacy_patient_benefit_override_code"
    length: 5
    padding: "left"
    pad_char: "0"
    required: false
    default_value: "0"

  # Field 22
  # Format: 9(1)
  # Required: N
  # Position: 210-210
  # Description: Blank defaults to 0.
  #              Non Blank – See Appendix B for list of valid values.
  - name: "COB Status"
    key: "pharmacy_cob_status"
    length: 1
    padding: "left"
    pad_char: "0"
    required: false
    default_value: "0"
    transform_lookup: "Lookup(\"cob_status_codes\", pharmacy_cob_status, pharmacy_cob_status)"

  # Field 23
  # Format: X(1)
  # Required: N
  # Position: 211-211
  # Description: • Blank (default) – refers to definition at higher level; if not defined, then regular processing rules
  #                apply.
  #              • N – Claims will be processed per regular processing rules.
  #              • Y – Suspension imposed; claims will be rejected for patient with appropriate suspension notification.
  #              • X – Suspension imposed; claims will be rejected for patients with submit reimbursement notification.
  - name: "Suspend Flag"
    key: "pharmacy_suspend_flag"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["N", "Y", "X", ""]
    transform: "pharmacy_suspend_flag?.ToUpper()"

  # Field 24
  # Format: X(1)
  # Required: Y
  # Position: 212-212
  # Description: This flag must be valued with "Y".
  #              For this field, if the value does not already exist in the database AND Pharmacy is Bypassed, then the
  #              flag will default to blank.
  - name: "Exception flag"
    key: "exception_flag"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["Y"]
    transform: "exception_flag?.ToUpper()"

  # Field 25
  # Format: 9(8)
  # Required: N
  # Position: 213-220
  # Description: Enrolment date is used to determine Anniversary Year Rollover date and Progressive Maximum Limits.
  #              Field default date should be zero's where not defined.
  #              Date of 9's to be considered an invalid date entry.
  - name: "Enrolment date"
    key: "enrolment_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: false
    default_value: "00000000"

  # Field 26
  # Format: X(1)
  # Required: N
  # Position: 221-221
  # Description: Provincial coordination of benefit rule number
  #              Used when a client / patient is covered by a provincial drug insurance plan. Avoids duplicate payments
  #              and ensures that the total amount paid under the combined coverage does not exceed 100% of the expenses
  #              incurred by the insured.
  #              When valued, it overrides the COB rule defined at a higher level. See Appendix E for a complete list of
  #              provincial drug COB rules.
  - name: "COB Rule"
    key: "cob_rule"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    transform_lookup: "Lookup(\"cob_rule_codes\", cob_rule, cob_rule?.ToUpper())"

  # Field 27
  # Format: X(1)
  # Required: N
  # Position: 222-222
  # Description: Bypass the LDF logic for the patient.
  #              Possible values are:
  #              • Y – The LDF logic is bypassed for the patient, and does not apply
  #              • N (default) – The LDF logic applies when defined at that level
  #              • Blank – When processing mode (field 17) =:
  #                • "R" – the field is set to "N" as the default.
  #                • "U" – on a first patient creation, the field is set to "N" as the default. If the patient already
  #                  exists, no update is performed on the field
  - name: "Bypass LDF Logic"
    key: "bypass_ldf_logic"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["Y", "N", ""]
    transform: "bypass_ldf_logic?.ToUpper()"

  # Field 28
  # Format: X(1)
  # Required: N
  # Position: 223-223
  # Description: Bypass the Methadone LDF logic for the patient.
  #              Possible values are:
  #              • Y – The Methadone LDF logic is bypassed for the patient, and does not apply
  #              • N (default) – The Methadone LDF logic applies when defined at that level.
  #              • Blank – When processing mode (field 23) =:
  #                • "R" – the field is set to "N" as the default.
  #                • "U" – on a first patient creation, the field is set to "N" as the default. If the patient already
  #                  exists, no update is performed on the field.
  - name: "Bypass Methadone LDF logic"
    key: "bypass_methadone_ldf_logic"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["Y", "N", ""]
    transform: "bypass_methadone_ldf_logic?.ToUpper()"

  # Field 29
  # Format: X(1)
  # Required: N
  # Position: 224-224
  # Description: Filler
  - name: "Filler"
    key: "filler_pharmacy_1"
    length: 1
    padding: "right"
    pad_char: " "
    required: false

  # Field 30
  # Format: X(1)
  # Required: N
  # Position: 225-225
  # Description: SDC program indicator
  #              Indicates if the patient is eligible for the SDC program:
  #              • Blank (default) – Patient is eligible for SDC and subject to SDC program rules, only if SDC is
  #                activated at a higher level (subgroup, group or carrier)
  #              • N – Patient is not eligible for SDC
  - name: "SDC Program Ind."
    key: "sdc_program_ind"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["N", ""]
    transform: "sdc_program_ind?.ToUpper()"

  # Field 31
  # Format: X(1)
  # Required: N
  # Position: 226-226
  # Description: Bypass the OMS logic for the patient.
  #              Possible values are:
  #              • Y – The OMS logic is bypassed for the patient, and does not apply
  #              • N (default) – The OMS logic applies when defined at that level
  #              • Blank – When processing mode (field 17) =:
  #                • "R" – the field is set to "N" as the default.
  #                • "U" – on a first patient creation, the field is set to "N" as the default. If the patient already
  #                  exists, no update is performed on the field.
  - name: "Bypass OMS Logic"
    key: "bypass_oms_logic"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["Y", "N", ""]
    transform: "bypass_oms_logic?.ToUpper()"

  # Field 32
  # Format: 9(3)
  # Required: N
  # Position: 227-229
  # Description: Indicates if patient has a grace period defined (in number of days) for Disease Program.
  #              Blank (default) – Patient doesn't have a grace period defined.
  #              Value from 0 to 365 – Patient has a grace period defined.
  - name: "Disease Program Grace Period"
    key: "disease_program_grace_period"
    length: 3
    padding: "left"
    pad_char: "0"
    required: false

  # Field 33
  # Format: X(1)
  # Required: N
  # Position: 230-230
  # Description: Plan is a Generic Plan, drug is interchangeable in the dispensing province (i.e., DIN's ITC
  #              (interchangeable) flag is 'Y' for the selected province) and input value is any of the following:
  #              • Y – The system uses the lower cost alternative (generic) drug
  #              • N – The system checks if the Product Selection Code submitted is:
  #                1 – The system uses the unit price of the submitted (brand) drug
  #                Not 1 – The system uses the lower cost alternative (generic) drug
  #              • Blank – Check next Mandatory Generic level in the hierarchy
  - name: "Mandatory Generic Indicator"
    key: "mandatory_generic_indicator"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["Y", "N", ""]
    transform: "mandatory_generic_indicator?.ToUpper()"

  # Field 34
  # Format: X(35)
  # Required: Y
  # Position: 231-261
  # Description: Filler
  - name: "Filler"
    key: "filler_pharmacy_2"
    length: 35
    padding: "right"
    pad_char: " "
    default_value: " "
    required: true

  # ========== DENTAL SECTION ==========

  # Field 35
  # Format: X(1)
  # Required: Y
  # Position: 262-262
  # Description: • B – Bypass record entirely.
  #              • R – Full replacement of information – Note: If a blank is submitted for a field on a full replacement,
  #                the field will be updated to blank. If the field is mandatory, it must be valued in R mode unless
  #                otherwise specified.
  #              • U – Update only fields which are valued (non blank):
  #              • If U selected, mandatory fields do not need to be sent unless they are being changed.
  #              • Mandatory fields cannot be blanked out.
  #              • If data currently exists on a non-mandatory field and it is to be updated to "blank", zeros or the
  #                default value (depending on format of field), then send "*" in the first position of the field to be
  #                blanked out.
  - name: "Dental Processing Mode"
    key: "dental_processing_mode"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["B", "R", "U"]
    transform: "dental_processing_mode?.ToUpper()"

  # Field 36
  # Format: 9(8)
  # Required: Y
  # Position: 263-270
  # Description: The effective date of the patient's dental coverage record.
  - name: "Dental Record Effective Date"
    key: "dental_record_effective_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: true

  # Field 37
  # Format: 9(8)
  # Required: N
  # Position: 271-278
  # Description: The termination date of the patient's dental coverage record.
  #              If not valued, defaults to 99999999.
  #              Note that all Dental Expiry Dates are the first day of non-coverage. Pharmacy Expiry Dates are the last
  #              day of coverage.
  - name: "Dental Record Expiry Date"
    key: "dental_record_expiry_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: false
    default_value: "99999999"

  # Field 38
  # Format: X(5)
  # Required: N
  # Position: 279-283
  # Description: The dental plan number for this patient. Leave blank to default to the client/group plan number.
  #              If blank, defaults to NULL.
  - name: "Plan Number"
    key: "dental_plan_number"
    length: 5
    padding: "right"
    pad_char: " "
    required: false

  # Field 39
  # Format: X(5)
  # Required: N
  # Position: 284-288
  # Description: Blank means do not override current benefit code value.
  #              If blank, defaults to NULL.
  - name: "Patient Benefit Override Code"
    key: "dental_patient_benefit_override_code"
    length: 5
    padding: "right"
    pad_char: " "
    required: false

  # Field 40
  # Format: 9(1)
  # Required: N
  # Position: 289-289
  # Description: Blank defaults to 0.
  #              Non Blank – See Appendix B for list of valid values.
  #              For adjudication purposes, 0 will default to client COB status.
  - name: "COB Status"
    key: "dental_cob_status"
    length: 1
    padding: "left"
    pad_char: "0"
    required: false
    default_value: "0"
    transform_lookup: "Lookup(\"cob_status_codes\", dental_cob_status, dental_cob_status)"

  # Field 41
  # Format: X(1)
  # Required: N
  # Position: 290-290
  # Description: • Blank (default) – refers to definition at higher level; if not defined, then regular processing rules
  #                apply.
  #              • N – Claims will be processed per regular processing rules.
  #              • Y – Suspension imposed; claims will be rejected for patient with appropriate suspension notification.
  #              • X – Suspension imposed; claims will be rejected for patients with submit reimbursement notification.
  - name: "Suspend Flag"
    key: "dental_suspend_flag"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["N", "Y", "X", ""]
    transform: "dental_suspend_flag?.ToUpper()"

  # Field 42
  # Format: X(1)
  # Required: N
  # Position: 291-291
  # Description: • Blank or N (default) – patient is not a late entrant.
  #              • Y – Patient is a late entrant.
  - name: "Late entrant indicator"
    key: "late_entrant_indicator"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["Y", "N", ""]
    transform: "late_entrant_indicator?.ToUpper()"

  # Field 43
  # Format: X(1)
  # Required: N
  # Position: 292-292
  # Description: • Y – Cost plus to be applied.
  #              • N – Cost plus plan is not to be accepted.
  #              Must be Y, N or blank.
  #              If blank, defaults to NULL.
  - name: "Cost Plus"
    key: "dental_cost_plus"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["Y", "N", ""]
    transform: "dental_cost_plus?.ToUpper()"

  # Field 44
  # Format: X(2)
  # Required: N
  # Position: 293-294
  # Description: Indicates which Private COB Rule will be followed.
  #              • 01 denotes CLHIA method of COB calculation.
  #              • 02 up to the current fee schedule.
  #              Must be 01, 02 or blank.
  - name: "Private COB Rule Code"
    key: "dental_private_cob_rule_code"
    length: 2
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["01", "02", ""]

  # Field 45
  # Format: 9(5)V99
  # Required: N
  # Position: 295-301
  # Description: Amount for automatic pending of EDI claims. Claims with amount greater than this amount will be
  #              automatically pended.
  #              9(5)V99
  #              Valid dollar amounts are 0.0 – 99999.99 and should be sent as 0000000 – 9999999
  #              If blank, defaults to 0.
  - name: "EDI Threshold Amount"
    key: "dental_edi_threshold_amount"
    length: 7
    padding: "left"
    pad_char: "0"
    required: false
    default_value: "0000000"

  # Field 46
  # Format: X(52)
  # Required: Y
  # Position: 302-357
  # Description: Filler
  - name: "Filler"
    key: "filler_dental"
    length: 52
    padding: "right"
    pad_char: " "
    default_value: " "
    required: true

