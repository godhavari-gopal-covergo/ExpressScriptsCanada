# EHC Patient Record - Type "32" & "37"
# Notes:
# - Type 32 records are sent alone as part of the regular Update/Load Process
# - Type 37 records act like a delete and add (used when patient's complete history is re-sent)
# - Default values unless already listed are NULL for nullable fields and a single space for non-nullable fields
record_type: "32"
description: "EHC Patient record with identification, general, and EHC information"

fields:
  # Field 01
  # Format: 9(2)
  # Required: Y
  # Position: 001-002
  # Description: "32" or "37"; denotes EHC Patient Record.
  - name: "Record Type"
    key: "record_type"
    length: 2
    padding: "left"
    pad_char: "0"
    required: true
    allowed_values: ["32", "37"]
    default_value: "32"

  # Field 02
  # Format: 9(2)
  # Required: Y
  # Position: 003-004
  # Description: The Express Scripts Canada-assigned Carrier ID # for the insurance carrier.
  - name: "Carrier ID"
    key: "carrier_id"
    length: 2
    padding: "left"
    pad_char: "0"
    required: true

  # Field 03
  # Format: X(10)
  # Required: Y
  # Position: 005-014
  # Description: Group Number assigned by the Customer. It should be the number as it appears on the member's card.
  - name: "Group Number"
    key: "group_number"
    length: 10
    padding: "right"
    pad_char: " "
    required: true

  # Field 04
  # Format: X(9)
  # Required: Y
  # Position: 015-023
  # Description: Subgroup (3) /Account (3) /Suffix (3)
  - name: "SAS"
    key: "sas"
    length: 9
    padding: "right"
    pad_char: " "
    required: true

  # Field 05
  # Format: X(15)
  # Required: Y
  # Position: 024-038
  # Description: Client's ID number.
  - name: "Client ID"
    key: "client_id"
    length: 15
    padding: "right"
    pad_char: " "
    required: true

  # Field 06
  # Format: X(3)
  # Required: Y
  # Position: 039-041
  # Description: Value Customer sends.
  #              The unique code (within carrier/group/client) assigned by either:
  #              1. The customer for patient records supplied by the customer.
  #              2. The adjudication system identified by the letter 'V' + 2 digit code (e.g. V01) for patient's added
  #                 on-the-fly.
  - name: "Current Patient Code"
    key: "current_patient_code"
    length: 3
    padding: "right"
    pad_char: " "
    required: true

  # ========== GENERAL SECTION ==========

  # Field 07
  # Format: X(1)
  # Required: Y
  # Position: 042-042
  # Description: • B – Bypass record entirely.
  #              • R – Full replacement of information – Note: If a blank is submitted for a field on a full replacement,
  #                the field will be updated to blank. If the field is mandatory, it must be valued in R mode unless
  #                otherwise specified.
  #              • U – Update only fields which are valued (non blank)
  #              • If U selected, mandatory fields do not need to be sent unless they are being changed.
  #              • Mandatory fields cannot be blanked out.
  #              • If data currently exists on a non-mandatory field and it is to be updated to "blank", zeros or the
  #                default value (depending on format of field), then send "*" in the first position of the field to be
  #                blanked out.
  - name: "General Processing Mode"
    key: "general_processing_mode"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["B", "R", "U"]
    transform: "general_processing_mode?.ToUpper()"

  # Field 08
  # Format: X(1)
  # Required: Y
  # Position: 043-043
  # Description: The relationship of the patient to the client. Values are:
  #              • 0 – Cardholder
  #              • 1 – Spouse
  #              • 2 – Child (underage)
  #              • 3 – Child (overage)
  #              • 4 – Disabled dependant
  #              For this field, if the value does not already exist in the database AND Pharmacy is Bypassed, then the
  #              relationship code will be valued as 0.
  - name: "Relationship Code"
    key: "relationship_code"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["0", "1", "2", "3", "4"]
    transform_lookup: "Lookup(\"relationship_codes\", relationship_code, relationship_code)"
    transform: "(relationship_code == null || relationship_code == \"\") && (ehc_processing_mode == \"B\") ? \"0\" : relationship_code"

  # Field 09
  # Format: X(30)
  # Required: N
  # Position: 044-073
  # Description: This field is mandatory when creating a new patient.
  #              If the mode is U and * is sent in the first position of the field, then an error will be generated and
  #              the record will be rejected.
  - name: "Full Patient Last Name"
    key: "patient_last_name"
    length: 30
    padding: "right"
    pad_char: " "
    required: false
    transform: "patient_last_name?.ToUpper()"

  # Field 10
  # Format: X(30)
  # Required: N
  # Position: 074-103
  # Description: This field is mandatory when creating a new patient.
  #              If the mode is U and * is sent in the first position of the field, then an error will be generated and
  #              the record will be rejected.
  - name: "Full Patient First Name"
    key: "patient_first_name"
    length: 30
    padding: "right"
    pad_char: " "
    required: false
    transform: "patient_first_name?.ToUpper()"

  # Field 11
  # Format: X(1)
  # Required: N
  # Position: 104-104
  # Description: If not valued, defaults to Blank.
  - name: "Patient Middle Initial"
    key: "patient_middle_initial"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    transform: "patient_middle_initial?.ToUpper()"

  # Field 12
  # Format: 9(8)
  # Required: Y
  # Position: 105-112
  # Description: Date of birth of the patient (YYYYMMDD)
  #              If value does not exist in the database AND Pharmacy is Bypassed, defaults to 00000000
  - name: "Patient Date of Birth"
    key: "patient_date_of_birth"
    length: 8
    padding: "right"
    pad_char: " "
    required: true

  # Field 13
  # Format: X(1)
  # Required: Y
  # Position: 113-113
  # Description: M = Male, F = Female, U = Unknown
  - name: "Patient Sex"
    key: "patient_sex"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["M", "F", "U"]
    transform: "patient_sex?.ToUpper()"

  # Field 14
  # Format: X(3)
  # Required: N
  # Position: 114-116
  # Description: Unique code assigned by customer to a patient.
  #              If valued, patient code will be changed to new patient code.
  #              Used for DUR and Rx Report processing.
  - name: "New Patient Code"
    key: "new_patient_code"
    length: 3
    padding: "right"
    pad_char: " "
    required: false

  # Field 15
  # Format: 9(8)
  # Required: N
  # Position: 117-124
  # Description: Date patient enrolled for dental coverage – used in late entrant and rising max processing.
  #              If not valued, defaults to 00000000.
  #              Valid values are 00000000, 99999999 or valid date.
  - name: "Dental enrolment date"
    key: "dental_enrolment_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: false
    default_value: "00000000"

  # Field 16
  # Format: X(58)
  # Required: Y
  # Position: 125-182
  # Description: Filler
  - name: "Filler"
    key: "filler_general"
    length: 58
    padding: "right"
    pad_char: " "
    default_value: " "
    required: true

  # ========== PHARMACY SECTION ==========

  # Field 17
  # Format: X(1)
  # Required: Y
  # Position: 183-183
  # Description: • B – Bypass record entirely.
  #              • R – Full replacement of information – Note: If a blank is submitted for a field on a full replacement,
  #                the field will be updated to blank. If the field is mandatory, it must be valued in R mode unless
  #                otherwise specified.
  #              • U – Update only fields which are valued (non blank)
  #              • If U selected, mandatory fields do not need to be sent unless they are being changed.
  #              • Mandatory fields cannot be blanked out.
  #              • If data currently exists on a non-mandatory field and it is to be updated to "blank", zeros or the
  #                default value (depending on format of field), then send "*" in the first position of the field to be
  #                blanked out.
  - name: "Pharmacy Processing Mode"
    key: "pharmacy_processing_mode"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["B", "R", "U"]
    transform: "pharmacy_processing_mode?.ToUpper()"

  # Field 18
  # Format: 9(8)
  # Required: Y
  # Position: 184-191
  # Description: The effective date of the patient's drug coverage.
  #              For this field, if the value does not already exist in the database AND Pharmacy is Bypassed, then the
  #              date will default to 00000000.
  - name: "Drug Effective Date"
    key: "drug_effective_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: true

  # Field 19
  # Format: 9(8)
  # Required: N
  # Position: 192-199
  # Description: The termination date of the patient's drug coverage.
  #              For this field, if the value does not already exist in the database AND Pharmacy is Bypassed, then the
  #              effective date will be 00000000. Otherwise, system will default to 99999999 if no date valued.
  #              Note that all Dental Expiry Dates are the first day of non-coverage. Pharmacy Expiry Dates are the last
  #              day of coverage.
  - name: "Drug Termination Date"
    key: "drug_termination_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: false
    default_value: "99999999"

  # Field 20
  # Format: X(5)
  # Required: N
  # Position: 200-204
  # Description: The drug plan number for this patient. Leave blank to default to the client/group plan number.
  - name: "Plan Number"
    key: "pharmacy_plan_number"
    length: 5
    padding: "right"
    pad_char: " "
    required: false

  # Field 21
  # Format: 9(5)
  # Required: N
  # Position: 205-209
  # Description: 0 is a valid value for this field.
  #              Blank defaults to 0.
  #              If 0, maintain current benefit override code on updates.
  - name: "Patient Benefit Override Code"
    key: "pharmacy_patient_benefit_override_code"
    length: 5
    padding: "left"
    pad_char: "0"
    required: false
    default_value: "0"

  # Field 22
  # Format: 9(1)
  # Required: N
  # Position: 210-210
  # Description: Blank defaults to 0.
  #              Non Blank – See Appendix B for list of valid values.
  - name: "COB Status"
    key: "pharmacy_cob_status"
    length: 1
    padding: "left"
    pad_char: "0"
    required: false
    default_value: "0"
    transform_lookup: "Lookup(\"cob_status_codes\", pharmacy_cob_status, pharmacy_cob_status)"

  # Field 23
  # Format: X(1)
  # Required: N
  # Position: 211-211
  # Description: • Blank (default) – refers to definition at higher level; if not defined, then regular processing rules
  #                apply.
  #              • N – Claims will be processed per regular processing rules.
  #              • Y – Suspension imposed; claims will be rejected for patient with appropriate suspension notification.
  #              • X – Suspension imposed; claims will be rejected for patients with submit reimbursement notification.
  - name: "Suspend Flag"
    key: "pharmacy_suspend_flag"
    length: 1
    padding: "right"
    pad_char: " "
    required: false
    allowed_values: ["N", "Y", "X", ""]
    transform: "pharmacy_suspend_flag?.ToUpper()"

  # Field 24
  # Format: X(1)
  # Required: Y
  # Position: 212-212
  # Description: This flag must be valued with "Y".
  #              For this field, if the value does not already exist in the database AND Pharmacy is Bypassed, then the
  #              flag will default to blank.
  - name: "Exception flag"
    key: "exception_flag"
    length: 1
    padding: "right"
    pad_char: " "
    required: true
    allowed_values: ["Y"]
    transform: "exception_flag?.ToUpper()"

  # Field 25
  # Format: 9(8)
  # Required: N
  # Position: 213-220
  # Description: Enrolment date is used to determine Anniversary Year Rollover date and Progressive Maximum Limits.
  #              Field default date should be zero's where not defined.
  #              Date of 9's to be considered an invalid date entry.
  - name: "Enrolment date"
    key: "enrolment_date"
    length: 8
    padding: "right"
    pad_char: " "
    required: false
    default_value: "00000000"

  # Field 26
  # Format: X(1)
  # Required: N
  # Position: 221-221
  # Description: Provincial coordination of benefit rule number
  #              Used when a client / patient is covered by a provincial drug insurance plan. Avoids duplicate payments
  #              and ensures that the total amount paid under the combined coverage does not exceed 100% of the expenses
  #              incurred by the insured.
  #              When valued, it overrides the COB rule defined at a higher level. See Appendix E for a compl}}